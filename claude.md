
# Claude Project Instructions: TextCastApp

## 1. プロジェクト概要
- フレームワーク: Expo (React Native, TypeScript)
- ターゲット: iOS シミュレーターおよび実機
- 共通依存: React, Expo, TypeScript
- 開発言語方針: TypeScript（型安全を優先）

## 2. 開発ルール
- デバッグ時は必ず `npx expo start --tunnel`
- **Claude は絶対にサーバーを起動しない**（人間が手動で行う）
- npm の扱い:
  - `npm ci` → lockfile に従って環境を完全再現
  - `npx expo install <パッケージ>` → 新規追加は必ず人間に確認
- git 操作は手動で行う
- コード品質:
  - `npm run lint` / `npm run format` は必要と判断する場合のみ実行
  - ESLint, Prettier のルールに従う
  - TypeScript の strict モードを有効化し、型安全を維持

## 3. 許可・禁止事項
- 許可:
  - bash: mkdir, touch, ls, cat, find, echo
  - npm: ci, run build, run test, run lint, run format
- 禁止:
  - bash: sudo, pkill, rm -rf
  - **サーバー起動コマンド全般**: npm run dev, npx expo start, expo start 等
  - git 操作全般
  - 読み込み禁止: .env, id_rsa, id_ed25519, **/*token*, **/*key*
  - 書き込み禁止: .env, **/secrets/**

## 4. 依存関係管理
- 依存関係は lockfile に従って再現
- 新しい依存は必ず確認を取ってから追加
- `npm ci` を基本とし、`npm install` は使わない

## 5. 開発フロー
- 開発起動: `npm run dev` または `npx expo start --tunnel`
- ビルド: `npm run build`
- テスト: `npm run test`
- 型チェック: `npm run tsc`（必要に応じて）
- コード整形 & Lint: `npm run lint` / `npm run format`

## 6. MCP 利用方針
- Selena MCP: ファイル認識強化用、自動で活用
- Supabase MCP: DB 操作は明示的に依頼する場合のみ使用
- その他 MCP: プロジェクトごとに必要なものだけ許可

## 7. 注意事項
- 新規ライブラリ追加時は必ず確認
- 実機デバッグは tunnel 固定
- TypeScript の型エラーは必ず解消してからコミット
- チーム開発時はこの指示を全員で共有


# TextCast - ポッドキャスト風テキスト読み上げアプリ 仕様書 

## 📋 プロジェクト概要

### アプリ名
**TextCast**

### コンセプト
多様なフォーマットのコンテンツを音声で効率的に消化できる、音楽アプリのような直感的な操作性を持つポッドキャスト風読み上げアプリ。

### ターゲット
- 通勤・散歩中に情報をインプットしたい人
- 論文や記事を音声で効率的に消化したい人
- 様々なドキュメントを聞き返したい人
- マルチタスクで学習したい人

---

## 🏗 システム設計

### アーキテクチャ
```
[React Native (Expo)]
        ↓
[AsyncStorage + iCloud/GoogleDrive] ←→ [TTS API] ←→ [AdMob] ←→ [File Parsers]


---
## 📱 機能仕様

### 1. マルチフォーマット入力機能

#### 1.1 手動テキスト入力
- タイトル・本文の直接入力
- 文字数制限・バリデーション
- リアルタイム文字数カウント

#### 1.2 ファイル読み込み
- **PDF**: テキスト抽出、画像内テキストOCR
- **Word/PowerPoint**: テキスト抽出
- **Markdown/TXT**: 直接読み込み
- **CSV**: 構造化データの自動整形
- **画像（JPG/PNG）**: OCRでテキスト化

#### 1.3 URL読み込み
- ウェブページのテキスト抽出
- 記事の本文自動判別
- メタデータ取得（タイトル、著者等）
- YouTube動画の字幕取得（将来機能）
- **共有機能統合**: ブラウザの共有ボタンからダイレクト保存

#### 1.4 カメラ入力
- 文書撮影→OCR→テキスト化
- リアルタイムテキスト認識

### 2. プレイリスト管理機能

#### 2.1 プレイリスト作成
- **無料版**: 最大20個（+ 紹介数）
- **プレミアム版**: 無制限
- カスタムカバー画像設定

#### 2.2 プレイリスト操作
- 一括操作（削除、移動、タグ付け）
- プレイリスト間でのアイテム移動


### 3. 音楽アプリ風再生体験

#### 3.1 グローバルプレイヤー
- 画面下部に常時表示
- ミニプレイヤー→フルプレイヤー展開
- バックグラウンド再生対応
- ロック画面コントロール

#### 3.2 再生コントロール
- **基本操作**: 再生/一時停止、前/次、シーク
- **速度調整**: 0.5x〜3.0x（0.25x刻み）
- **リピート**: オフ/1曲/全曲
- **シャッフル**: ランダム再生

#### 3.3 高度な再生機能
- **スマートポーズ**: 句読点で自動一時停止
- **ジャンプ機能**: 段落単位でスキップ
- **ブックマーク**: 重要箇所をマーク
- **再生履歴**: 最近聞いた箇所

### 4. リファラル機能

#### 4.1 紹介システム
- 個人紹介コード生成
- 紹介リンク共有（SNS、メール）
- 紹介成功で両者にボーナス

#### 4.2 報酬システム
- **紹介者**: プレイリスト上限+1（恒久）
- **被紹介者**: 初回ボーナス（プレミアム機能1週間無料）
- 紹介実績の可視化

### 5. データ管理・バックアップ

#### 6.1 共有機能（Share Extension）
- **ブラウザ統合**: Safari、Chrome等の共有ボタンからアプリ選択
- **ワンタップ保存**: URLを自動解析してテキスト抽出
- **バックグラウンド処理**: アプリ起動せずに保存完了
- **通知表示**: 保存完了を通知で確認

#### 6.2 対応共有元
- **ウェブブラウザ**: Safari、Chrome、Firefox等
- **SNSアプリ**: Twitter、Facebook等の記事リンク
- **ニュースアプリ**: 各種ニュースアプリからの記事
- **メールアプリ**: メール内のURLリンク

#### 6.3 共有時の自動処理
- URL の有効性チェック
- ページタイトル・本文の自動抽出
- 適切なプレイリストへの自動分類
- 重複チェック（同一URLの再保存防止）

#### 5.1 ローカルストレージ
- AsyncStorage でメインデータ
- 高速アクセスのためのキャッシュ最適化
- 容量管理・古いデータの自動削除

#### 5.2 クラウドバックアップ
- **iOS**: iCloud Drive 連携
- **Android**: Google Drive 連携
- 自動バックアップ（日次/週次）
- 手動バックアップ・復元

#### 5.3 データ同期
- 複数デバイス間での同期
- 競合解決メカニズム
- 差分バックアップで通信量削減


## 🔧 技術仕様

### 使用技術スタック
- **Framework**: React Native (Expo SDK 49+)
- **言語**: TypeScript
- **状態管理**: Zustand + AsyncStorage
- **ナビゲーション**: @react-navigation/native v6
- **音声合成**: expo-speech
- **共有機能**: expo-sharing + Custom Share Extension
- **ファイル処理**: 
  - PDF: react-native-pdf-lib
  - Word: mammoth.js
  - OCR: expo-camera + ML Kit
- **URL解析**: cheerio + readability.js
- **クラウド連携**:
  - iOS: @react-native-async-storage/async-storage + iCloud
  - Android: Google Drive API
- **広告**: expo-ads-admob
- **課金**: expo-in-app-purchases

---


## ⚠️ 技術的考慮事項

### パフォーマンス
- 大きなファイルの段階的処理
- 音声再生時のメモリ管理
- プレイリストの仮想化

### セキュリティ
- ファイル処理時のサンドボックス化
- クラウドバックアップの暗号化
- 個人情報の適切な管理

### プラットフォーム対応
- iOS/AndroidのTTS品質差
- ファイルアクセス権限の違い
- バックグラウンド処理の制限

---

## 💰 収益化戦略

### 無料版制限
- プレイリスト: 20個（+ 紹介ボーナス）
- 広告表示: バナー + インタースティシャル
- ファイル処理: 月10件まで

### プレミアム版（￥480/月）
- プレイリスト無制限
- 広告完全非表示
- ファイル処理無制限
- クラウド無制限バックアップ
- 高度な音声設定